# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
Index: include/arch/win32/apr_private.h
===================================================================
--- include/arch/win32/apr_private.h	(revision 408977)
+++ include/arch/win32/apr_private.h	(working copy)
@@ -67,6 +67,12 @@
 #include <time.h>
 #endif
 
+#if !APR_HAVE_CRTDBG_H
+#define _malloc_dbg(size, block, file, line) malloc(size)
+#define _realloc_dbg(mem, size, block, file, line) realloc(mem, size)
+#endif
+
+
 /* Use this section to define all of the HAVE_FOO_H
  * that are required to build properly.
  */
Index: include/apr.hw
===================================================================
--- include/apr.hw	(revision 408977)
+++ include/apr.hw	(working copy)
@@ -153,6 +153,7 @@
 #define APR_HAVE_STDDEF_H       1
 #define APR_HAVE_PROCESS_H      1
 #define APR_HAVE_TIME_H         1
+#define APR_HAVE_CRTDBG_H       1
 #else
 #define APR_HAVE_ARPA_INET_H    0
 #define APR_HAVE_CONIO_H        0
@@ -186,6 +187,7 @@
 #define APR_HAVE_STDDEF_H       0
 #define APR_HAVE_PROCESS_H      0
 #define APR_HAVE_TIME_H         0
+#define APR_HAVE_CRTDBG_H       0
 #endif
 
 #define APR_USE_FLOCK_SERIALIZE           0 
Index: misc/win32/apr_app.c
===================================================================
--- misc/win32/apr_app.c	(revision 408977)
+++ misc/win32/apr_app.c	(working copy)
@@ -35,7 +35,9 @@
 
 #include "apr_general.h"
 #include "ShellAPI.h"
+#if APR_HAVE_CRTDBG_H
 #include "crtdbg.h"
+#endif
 #include "wchar.h"
 #include "apr_arch_file_io.h"
 #include "assert.h"
Index: misc/win32/internal.c
===================================================================
--- misc/win32/internal.c	(revision 408977)
+++ misc/win32/internal.c	(working copy)
@@ -18,7 +18,9 @@
 
 #include "apr_arch_misc.h"
 #include "apr_arch_file_io.h"
+#if APR_HAVE_CRTDBG_H
 #include <crtdbg.h>
+#endif
 #include <assert.h>
 
 /* This module is the source of -static- helper functions that are
Index: misc/win32/misc.c
===================================================================
--- misc/win32/misc.c	(revision 408977)
+++ misc/win32/misc.c	(working copy)
@@ -16,7 +16,9 @@
 
 #include "apr_private.h"
 #include "apr_arch_misc.h"
+#if APR_HAVE_CRTDBG_H
 #include "crtdbg.h"
+#endif
 #include "apr_arch_file_io.h"
 #include "assert.h"
 #include "apr_lib.h"
Index: misc/win32/start.c
===================================================================
--- misc/win32/start.c	(revision 408977)
+++ misc/win32/start.c	(working copy)
@@ -23,7 +23,9 @@
 #include "apr_arch_misc.h"       /* for WSAHighByte / WSALowByte */
 #include "wchar.h"
 #include "apr_arch_file_io.h"
+#if APR_HAVE_CRTDBG_H
 #include "crtdbg.h"
+#endif
 #include "assert.h"
 
 /* This symbol is _private_, although it must be exported.
