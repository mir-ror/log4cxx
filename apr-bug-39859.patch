# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
Index: network_io/win32/sockets.c
===================================================================
--- network_io/win32/sockets.c	(revision 408977)
+++ network_io/win32/sockets.c	(working copy)
@@ -112,7 +112,7 @@
      * purposes, always transform the socket() created as a non-inherited
      * handle
      */
-#if APR_HAS_UNICODE_FS
+#if APR_HAS_UNICODE_FS && !defined(_WIN32_WCE)
     IF_WIN_OS_IS_UNICODE {
         /* A different approach.  Many users report errors such as 
          * (32538)An operation was attempted on something that is not 
@@ -127,7 +127,7 @@
                              HANDLE_FLAG_INHERIT, 0);
     }
 #endif
-#if APR_HAS_ANSI_FS
+#if APR_HAS_ANSI_FS || defined(_WIN32_WCE)
     ELSE_WIN_OS_IS_ANSI {
         HANDLE hProcess = GetCurrentProcess();
         HANDLE dup;
