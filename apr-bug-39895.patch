Index: misc/unix/errorcodes.c
===================================================================
--- misc/unix/errorcodes.c	(revision 408977)
+++ misc/unix/errorcodes.c	(working copy)
@@ -247,15 +247,35 @@
     apr_size_t len=0, i;
 
 #ifndef NETWARE
-    len = FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM 
+#if !defined(_WIN32_WCE)
+    len = FormatMessageA(FORMAT_MESSAGE_FROM_SYSTEM 
                       | FORMAT_MESSAGE_IGNORE_INSERTS,
                         NULL,
                         errcode,
                         MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), /* Default language */
-                        (LPTSTR) buf,
+                        (LPSTR) buf,
                         (DWORD)bufsize,
                         NULL);
+#else
+    len = FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM 
+                      | FORMAT_MESSAGE_IGNORE_INSERTS,
+                        NULL,
+                        errcode,
+                        LOCALE_INVARIANT,
+                        (LPTSTR) buf,
+                        (DWORD) (bufsize/sizeof(TCHAR)),
+                        NULL);
+    //
+    //  compact to US-ASCII, replace any non US-ASCII with '?'
+    for(i = 0; i <= len; i++) {
+        if (((TCHAR*) buf)[i] < 0x80) {
+            buf[i] = (char) ((TCHAR*) buf)[i];
+        } else {
+            buf[i] = '?';
+        }
+    }
 #endif
+#endif
 
     if (!len) {
         for (i = 0; gaErrorList[i].msg; ++i) {
